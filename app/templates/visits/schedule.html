{% extends "base.html" %}
{% block title %}Schedule Visits - MiKlean{% endblock %}

{% block header %}
<div class="flex items-center">
    <a href="{{ url_for('clients.view_client', client_id=client.id) }}" class="mr-3 text-ink/60 hover:text-ink">
        <i data-lucide="x" class="w-6 h-6"></i>
    </a>
    <div>
        <h1 class="text-xl font-bold text-ink">Add to Schedule</h1>
        <p class="text-sm text-ink/60">{{ client.name }}</p>
    </div>
</div>
{% endblock %}

{% block bottom_nav %}{% endblock %}

{% block content %}
<form method="POST" class="space-y-4">
    <!-- Schedule Type Selection -->
    <div class="card card-brand">
        <label class="block text-sm font-medium text-neutral-600 mb-3">What are you scheduling?</label>
        <div class="grid grid-cols-2 gap-3">
            <label class="relative">
                <input type="radio" name="frequency" value="one_time" class="peer sr-only" checked>
                <div class="p-4 text-center rounded-lg cursor-pointer border-b-3 border-neutral-200 bg-neutral-50 text-neutral-600 peer-checked:border-brand peer-checked:bg-brand/10 peer-checked:text-ink font-semibold transition-all">
                    <i data-lucide="calendar-check" class="w-6 h-6 mx-auto mb-2"></i>
                    <span class="text-sm">One-Time Visit</span>
                </div>
            </label>
            <label class="relative">
                <input type="radio" name="frequency" value="recurring" class="peer sr-only">
                <div class="p-4 text-center rounded-lg cursor-pointer border-b-3 border-neutral-200 bg-neutral-50 text-neutral-600 peer-checked:border-brand peer-checked:bg-brand/10 peer-checked:text-ink font-semibold transition-all">
                    <i data-lucide="repeat" class="w-6 h-6 mx-auto mb-2"></i>
                    <span class="text-sm">Recurring Schedule</span>
                </div>
            </label>
        </div>
    </div>
    
    <!-- Price -->
    <div class="card">
        <label for="price" class="block text-sm font-medium text-neutral-600 mb-1.5">Price Per Visit *</label>
        <input type="text" id="price" name="price" required
            value="{{ '%.2f'|format(estimate.price_per_visit) if estimate else '' }}"
            class="input text-xl font-bold" placeholder="$150.00">
        {% if estimate %}
        <p class="text-xs text-neutral-400 mt-2">From estimate: ${{ '%.2f'|format(estimate.price_per_visit) }}</p>
        {% endif %}
    </div>
    
    <!-- Date/Time -->
    <div class="card">
        <div class="space-y-4">
            <div>
                <label for="start_date" class="block text-sm font-medium text-neutral-600 mb-1.5">
                    <span id="date_label">Visit Date</span> *
                </label>
                <input type="date" id="start_date" name="start_date" required class="input">
            </div>
            
            <div>
                <label for="preferred_time" class="block text-sm font-medium text-neutral-600 mb-1.5">Time (optional)</label>
                <input type="time" id="preferred_time" name="preferred_time" class="input">
            </div>
        </div>
    </div>
    
    <!-- Recurring Options (hidden by default) -->
    <div id="recurring_options" class="card hidden">
        <p class="text-sm font-semibold text-ink mb-3">How Often?</p>
        
        <div class="space-y-4">
            <!-- Quick Options -->
            <div class="grid grid-cols-2 gap-2">
                <label class="relative">
                    <input type="radio" name="recurring_frequency" value="weekly" class="peer sr-only" checked>
                    <div class="p-3 text-center rounded-lg cursor-pointer border-b-3 border-neutral-200 bg-neutral-50 text-neutral-600 peer-checked:border-brand peer-checked:bg-brand/10 peer-checked:text-ink font-semibold text-sm transition-all">
                        Weekly
                    </div>
                </label>
                <label class="relative">
                    <input type="radio" name="recurring_frequency" value="biweekly" class="peer sr-only">
                    <div class="p-3 text-center rounded-lg cursor-pointer border-b-3 border-neutral-200 bg-neutral-50 text-neutral-600 peer-checked:border-brand peer-checked:bg-brand/10 peer-checked:text-ink font-semibold text-sm transition-all">
                        Every 2 Weeks
                    </div>
                </label>
                <label class="relative">
                    <input type="radio" name="recurring_frequency" value="monthly" class="peer sr-only">
                    <div class="p-3 text-center rounded-lg cursor-pointer border-b-3 border-neutral-200 bg-neutral-50 text-neutral-600 peer-checked:border-brand peer-checked:bg-brand/10 peer-checked:text-ink font-semibold text-sm transition-all">
                        Monthly
                    </div>
                </label>
                <label class="relative">
                    <input type="radio" name="recurring_frequency" value="custom" class="peer sr-only">
                    <div class="p-3 text-center rounded-lg cursor-pointer border-b-3 border-neutral-200 bg-neutral-50 text-neutral-600 peer-checked:border-brand peer-checked:bg-brand/10 peer-checked:text-ink font-semibold text-sm transition-all">
                        Custom...
                    </div>
                </label>
            </div>
            
            <!-- Custom Interval (hidden by default) -->
            <div id="custom_interval" class="hidden p-4 bg-neutral-50 rounded-lg">
                <label class="block text-sm font-medium text-neutral-600 mb-2">Every how many months?</label>
                <div class="flex items-center gap-3">
                    <span class="text-neutral-500">Every</span>
                    <input type="number" id="custom_months" name="custom_months" min="1" max="12" value="3" 
                        class="input w-20 text-center font-bold">
                    <span class="text-neutral-500">month(s)</span>
                </div>
                <p class="text-xs text-neutral-400 mt-2">Great for deep cleans, seasonal visits, etc.</p>
            </div>
            
            <div>
                <label for="num_visits" class="block text-sm font-medium text-neutral-600 mb-1.5">How many visits to schedule?</label>
                <select id="num_visits" name="num_visits" class="input">
                    <option value="4">4 visits</option>
                    <option value="6">6 visits</option>
                    <option value="8" selected>8 visits</option>
                    <option value="12">12 visits</option>
                </select>
            </div>
        </div>
        
        <div class="mt-4 p-3 bg-brand/10 rounded-lg">
            <p class="text-sm text-ink/70">
                <strong>Note:</strong> As you complete visits, new ones are added automatically to maintain your schedule.
            </p>
        </div>
    </div>
    
    <div class="space-y-3 pt-2">
        <button type="submit" class="btn-primary w-full">
            <span id="submit_text">Schedule Visit</span>
        </button>
        <a href="{{ url_for('clients.view_client', client_id=client.id) }}" class="btn-secondary w-full">Cancel</a>
    </div>
</form>

<script>
    const frequencyRadios = document.querySelectorAll('input[name="frequency"]');
    const recurringOptions = document.getElementById('recurring_options');
    const dateLabel = document.getElementById('date_label');
    const submitText = document.getElementById('submit_text');
    
    const recurringFrequencyRadios = document.querySelectorAll('input[name="recurring_frequency"]');
    const customInterval = document.getElementById('custom_interval');
    
    frequencyRadios.forEach(radio => {
        radio.addEventListener('change', () => {
            if (radio.value === 'recurring' && radio.checked) {
                recurringOptions.classList.remove('hidden');
                dateLabel.textContent = 'Start Date';
                submitText.textContent = 'Create Schedule';
            } else {
                recurringOptions.classList.add('hidden');
                dateLabel.textContent = 'Visit Date';
                submitText.textContent = 'Schedule Visit';
            }
        });
    });
    
    recurringFrequencyRadios.forEach(radio => {
        radio.addEventListener('change', () => {
            if (radio.value === 'custom' && radio.checked) {
                customInterval.classList.remove('hidden');
            } else {
                customInterval.classList.add('hidden');
            }
        });
    });
    
    // Re-init Lucide icons after page load
    lucide.createIcons();
</script>
{% endblock %}
