{% extends "base.html" %}
{% block title %}Add Prospect - MiKlean{% endblock %}

{% block header %}
<div class="flex items-center justify-between">
    <div class="flex items-center">
        <a href="{{ url_for('clients.list_clients') }}" class="mr-4 text-white/60 hover:text-white">
            <i data-lucide="x" class="w-6 h-6"></i>
        </a>
        <h1 class="text-2xl font-bold text-white">Add Prospect</h1>
    </div>
</div>
{% endblock %}

{% block bottom_nav %}{% endblock %}

{% block content %}
<form method="POST" class="space-y-4">
    <div class="card">
        <div class="space-y-4">
            <div>
                <label for="name" class="block text-sm font-semibold text-white/60 mb-2">Name *</label>
                <input type="text" id="name" name="name" required
                    value="{{ name or '' }}"
                    class="input input-dark"
                    placeholder="Full name">
            </div>
            
            <div>
                <label for="phone" class="block text-sm font-semibold text-white/60 mb-2">Phone *</label>
                <input type="tel" id="phone" name="phone" required
                    value="{{ phone or '' }}"
                    class="input input-dark"
                    placeholder="(555) 123-4567">
            </div>
            
            <div>
                <label for="email" class="block text-sm font-semibold text-white/60 mb-2">Email</label>
                <input type="email" id="email" name="email"
                    value="{{ email or '' }}"
                    class="input input-dark"
                    placeholder="client@example.com">
            </div>
        </div>
    </div>
    
    <!-- Address Section -->
    <div class="card">
        <p class="text-sm font-bold text-white/60 uppercase tracking-wider mb-4">Address</p>
        
        <!-- Search Box -->
        <div class="mb-4">
            <input type="text" id="address_search" 
                class="input bg-brand text-ink font-semibold"
                placeholder="ðŸ” Search address...">
            <p class="text-xs text-white/40 mt-2">Or enter manually below</p>
        </div>
        
        <div class="space-y-4">
            <div>
                <label for="street1" class="block text-xs font-semibold text-white/50 mb-1">Street Address *</label>
                <input type="text" id="street1" name="street1" required
                    value="{{ street1 or '' }}"
                    class="input input-dark"
                    placeholder="123 Main St">
            </div>
            
            <div>
                <label for="street2" class="block text-xs font-semibold text-white/50 mb-1">Apt, Suite (optional)</label>
                <input type="text" id="street2" name="street2"
                    value="{{ street2 or '' }}"
                    class="input input-dark"
                    placeholder="Apt 4B">
            </div>
            
            <div class="grid grid-cols-2 gap-3">
                <div>
                    <label for="city" class="block text-xs font-semibold text-white/50 mb-1">City *</label>
                    <input type="text" id="city" name="city" required
                        value="{{ city or '' }}"
                        class="input input-dark"
                        placeholder="City">
                </div>
                <div>
                    <label for="state" class="block text-xs font-semibold text-white/50 mb-1">State *</label>
                    <select id="state" name="state" required class="input input-dark">
                        <option value="">State</option>
                        {% for st in ['AL','AK','AZ','AR','CA','CO','CT','DE','FL','GA','HI','ID','IL','IN','IA','KS','KY','LA','ME','MD','MA','MI','MN','MS','MO','MT','NE','NV','NH','NJ','NM','NY','NC','ND','OH','OK','OR','PA','RI','SC','SD','TN','TX','UT','VT','VA','WA','WV','WI','WY','DC'] %}
                        <option value="{{ st }}" {% if state == st %}selected{% endif %}>{{ st }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            
            <div class="w-1/2">
                <label for="zip_code" class="block text-xs font-semibold text-white/50 mb-1">ZIP Code *</label>
                <input type="text" id="zip_code" name="zip_code" required
                    value="{{ zip_code or '' }}"
                    class="input input-dark"
                    placeholder="12345">
            </div>
        </div>
    </div>
    
    <div class="card">
        <label for="notes" class="block text-sm font-semibold text-white/60 mb-2">Notes</label>
        <textarea id="notes" name="notes" rows="3"
            class="input input-dark"
            placeholder="Gate code, pets, special instructions...">{{ notes or '' }}</textarea>
    </div>
    
    <div class="space-y-3 pt-2">
        <button type="submit" class="btn-white w-full">
            Save Prospect
        </button>
        <a href="{{ url_for('clients.list_clients') }}" class="btn-outline w-full">
            Cancel
        </a>
    </div>
</form>
{% endblock %}

{% block scripts %}
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCLOXScYN0mjaerNSdgCQOkqY5YFK0BWt0&libraries=places&callback=initAutocomplete" async defer></script>
<script>
function initAutocomplete() {
    const searchInput = document.getElementById('address_search');
    
    const autocomplete = new google.maps.places.Autocomplete(searchInput, {
        types: ['address'],
        componentRestrictions: { country: 'us' },
        fields: ['address_components', 'formatted_address']
    });
    
    autocomplete.addListener('place_changed', function() {
        const place = autocomplete.getPlace();
        if (!place.address_components) return;
        
        document.getElementById('street1').value = '';
        document.getElementById('city').value = '';
        document.getElementById('state').value = '';
        document.getElementById('zip_code').value = '';
        
        let streetNumber = '';
        let streetName = '';
        
        for (const component of place.address_components) {
            const type = component.types[0];
            switch (type) {
                case 'street_number': streetNumber = component.long_name; break;
                case 'route': streetName = component.long_name; break;
                case 'locality': document.getElementById('city').value = component.long_name; break;
                case 'administrative_area_level_1': document.getElementById('state').value = component.short_name; break;
                case 'postal_code': document.getElementById('zip_code').value = component.long_name; break;
            }
        }
        
        document.getElementById('street1').value = streetNumber + (streetNumber && streetName ? ' ' : '') + streetName;
        searchInput.value = '';
        document.getElementById('street2').focus();
    });
    
    searchInput.addEventListener('keydown', function(e) {
        if (e.key === 'Enter') e.preventDefault();
    });
}
</script>
<style>
.pac-container { border-radius: 16px; border: none; box-shadow: 0 8px 32px rgba(0,0,0,0.3); margin-top: 8px; background: #1A1A1A; }
.pac-item { padding: 14px 18px; cursor: pointer; border-top: 1px solid #333; color: white; }
.pac-item:first-child { border-top: none; }
.pac-item:hover { background-color: #333; }
.pac-item-query { font-size: 14px; color: white; }
.pac-matched { font-weight: 700; color: #FFC107; }
.pac-icon { display: none; }
</style>
{% endblock %}
